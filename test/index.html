<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Tester</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 5px; padding: 10px; }
        #result { margin-top: 20px; padding: 10px; background: #f0f0f0; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>ReJoEs Server API Tester</h1>
    <p>Make sure the server is running on http://localhost:3000</p>
    
    <h2>Members API</h2>
    <button onclick="testCreateMember()">Create Test Member</button>
    <button onclick="testGetMember()">Get Member by Card Token</button>
    
    <h2>Loans API</h2>
    <button onclick="testCheckout()">Checkout Loan</button>
    <button onclick="testReturn()">Return Loan</button>
    <button onclick="testSwap()">Swap Loan</button>
    
    <h2>Response</h2>
    <div id="result">Click a button to test an API...</div>
        <script>
        const baseUrl = 'http://localhost:3000';
        let lastCardToken = '';
        
        function displayResult(data, testName) {
            let content = `Test: ${testName}\n`;
            if (data.error) {
                content += `Error: ${data.error}\n`;
                if (data.stack) {
                    content += `Stack: ${data.stack}\n`;
                }
            } else {
                content += `Status: ${data.status}\n`;
                content += `Response:\n${JSON.stringify(data.data || data, null, 2)}\n`;
            }
            document.getElementById('result').innerText = content;
        }
        
        async function testCreateMember() {
            const testName = 'Create Member';
            const cardToken = `test-${Date.now()}`;
            lastCardToken = cardToken;
            try {
                const res = await fetch(`${baseUrl}/api/members/dev/seed-member`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        cardToken,
                        tier: 'PREMIUM',
                        email: `test-${Date.now()}@example.com`,
                        name: 'Test User',
                        phone: '1234567890'
                    })
                });
                const data = await res.json();
                displayResult({ status: res.status, data: { ...data, generatedCardToken: cardToken } }, testName);
            } catch (e) {
                displayResult({ error: e.message, stack: e.stack }, testName);
            }
        }
        
        async function testGetMember() {
            const testName = 'Get Member';
            if (!lastCardToken) {
                displayResult({ error: 'No member created yet. Click "Create Test Member" first.' }, testName);
                return;
            }
            try {
                const res = await fetch(`${baseUrl}/api/members/card/${lastCardToken}`);
                const data = await res.json();
                displayResult({ status: res.status, data }, testName);
            } catch (e) {
                displayResult({ error: e.message, stack: e.stack }, testName);
            }
        }
        
        async function testCheckout() {
            const testName = 'Checkout Loan';
            try {
                const res = await fetch(`${baseUrl}/api/loans/checkout`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        memberId: 'fake-member-id',
                        uploadId: 'fake-upload-id',
                        storeLocation: 'Test Store'
                    })
                });
                const data = await res.json();
                displayResult({ status: res.status, data }, testName);
            } catch (e) {
                displayResult({ error: e.message, stack: e.stack }, testName);
            }
        }
        
        async function testReturn() {
            const testName = 'Return Loan';
            try {
                const res = await fetch(`${baseUrl}/api/loans/return`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        memberId: 'fake-member-id',
                        loanId: 'fake-loan-id'
                    })
                });
                const data = await res.json();
                displayResult({ status: res.status, data }, testName);
            } catch (e) {
                displayResult({ error: e.message, stack: e.stack }, testName);
            }
        }
        
        async function testSwap() {
            const testName = 'Swap Loan';
            try {
                const res = await fetch(`${baseUrl}/api/loans/swap`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        memberId: 'fake-member-id',
                        loanId: 'fake-loan-id',
                        uploadId: 'fake-swap-upload-id',
                        storeLocation: 'New Store'
                    })
                });
                const data = await res.json();
                displayResult({ status: res.status, data }, testName);
            } catch (e) {
                displayResult({ error: e.message, stack: e.stack }, testName);
            }
        }
    </script>
</body>
</html>
